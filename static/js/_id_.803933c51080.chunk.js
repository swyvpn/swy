import{n as x,a9 as L,r as u,ar as F,j as r,aJ as a,i as b,bx as M,bQ as G,bR as H,bS as R,ah as S,T as N,aj as Q,bT as j,F as B,av as W,ai as q,bP as z,bo as U,bp as $,a7 as T,bq as J,bU as V,bV as K,bh as _,b0 as I,bW as X,H as Z,af as w,p as A,v as D,as as ee,bI as re}from"./vendor.dee56adfed90.chunk.js";import{w as te,x as ce,y as ne,M as E,m as O,v as oe,A as Y,z as ae,b as ie}from"./index.23055111bb7c.js";import{c as se}from"./constate.es.765af53af19c.chunk.js";import{O as d}from"./order.269a0794995b.chunk.js";import{a as y}from"./plan.a4c4be1cb76c.chunk.js";const de=({tradeNo:t})=>{var g;const{t:e}=x(),{enqueueSnackbar:i}=L(),[c,s]=u.useState(d.PENDING),[o,m]=u.useState(!1),l=te(t),h=ce(t,{skip:c!==d.PENDING&&c!==d.PAID||!l.isSuccess,pollingInterval:1e3}),f=ne(void 0,{skip:c!==d.PENDING||!l.isSuccess}),[v,n]=u.useState(0),p=u.useMemo(()=>{var k;return new Map((k=f.data)==null?void 0:k.map(P=>[P.id,P]))},[f.data]);return u.useEffect(()=>{v===0&&f.isSuccess&&n(f.data[0].id)},[f.isSuccess,v,f.data]),u.useEffect(()=>{var k;(k=l.data)!=null&&k.status&&s(l.data.status)},[(g=l.data)==null?void 0:g.status]),u.useEffect(()=>{h.data&&s(h.data)},[h.data]),u.useEffect(()=>{l.error&&i(e("notice::order-detail-error",{error:l.error.message}),{variant:"error"})},[l.error]),{tradeNo:t,status:c,detail:l,callback:h,paymentMethod:f,paymentMethodIndex:p,paymentMethodState:v,setPaymentMethodState:n,isSubmitting:o,setSubmitting:m}},[le,C]=se(de),ue=()=>{const{t}=x(),{detail:{data:e,isLoading:i}}=C(),c=u.useMemo(()=>{const o=F.unix((e==null?void 0:e.created_at)||0);switch(e==null?void 0:e.period){case y.MONTHLY:return o.add(1,"month");case y.QUARTERLY:return o.add(3,"month");case y.HALF_YEARLY:return o.add(6,"month");case y.YEARLY:return o.add(1,"year");case y.TWO_YEARLY:return o.add(2,"year");case y.THREE_YEARLY:return o.add(3,"year");default:return o}},[e==null?void 0:e.created_at,e==null?void 0:e.period]),s=u.useMemo(()=>[{label:t("order.checkout.product-info-card.product-name"),value:e==null?void 0:e.plan.name},{label:t("order.checkout.product-info-card.product-type"),value:t("order.checkout.product-info-card.product-period",{context:e==null?void 0:e.period})},{label:t("order.checkout.product-info-card.traffic"),value:t("order.checkout.product-info-card.traffic",{count:(e==null?void 0:e.plan.transfer_enable)||0,context:(e==null?void 0:e.plan.transfer_enable)===null?"unlimited":"limited"})},...(e==null?void 0:e.period)===y.ONETIME?[]:[{label:t("order.checkout.product-info-card.next-billing-date"),value:c.format("YYYY/MM/DD")}]],[e,t,c]);return r(E,{title:t("order.checkout.product-info-card.title"),children:r(a,{container:!0,spacing:1,children:s.map((o,m)=>r(a,{item:!0,xs:12,children:b(a,{container:!0,spacing:2,children:[r(a,{item:!0,xs:4,children:o.label}),r(a,{item:!0,xs:8,children:i?r(M,{variant:"text",width:"100%"}):o.value})]})},m))})})},he=O()((t,{status:e})=>({root:{padding:t.spacing(1)},icon:{fontSize:t.spacing(8),color:t.palette[e===d.FINISHED?"success":"warning"].main}})),me=()=>{const{t}=x(),{status:e}=C(),{classes:i}=he({status:e}),c=u.useMemo(()=>{switch(e){case d.FINISHED:return r(R,{className:i.icon});case d.CANCELLED:return r(H,{className:i.icon});case d.PENDING:return r(G,{className:i.icon});default:return null}},[e]),s=u.useMemo(()=>{switch(e){case d.FINISHED:return"finished";case d.CANCELLED:return"cancelled";case d.PAID:return"paid";default:return null}},[e]);return r(E,{className:i.root,children:r(S,{direction:"column",spacing:3,children:b(S,{direction:"column",spacing:1,alignItems:"center",children:[c,r(N,{variant:"h3",children:t("order.checkout.status-card.status",{context:s})}),r(N,{variant:"body1",color:"textSecondary",align:"center",children:t("order.checkout.status-card.description",{context:s})})]})})})},pe=()=>{const{t}=x(),[e,{setLeft:i,setRight:c}]=Q(!1),{tradeNo:s}=C(),[o]=oe(),{enqueueSnackbar:m}=L(),l=j(async()=>{try{const h=await o(s).unwrap();h?(m(t("notice::order-cancel_success"),{variant:"success"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:s,success:!0})):(m(t("notice::order-cancel_failed"),{variant:"error"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:s,success:!1,error:h}))}catch(h){console.error("error when cancel order:",h),m(t("notice::order-cancel_failed"),{variant:"error"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:s,success:!1,error:h})}i()});return b(B,{children:[r(W,{title:t("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:r(q,{onClick:c,children:r(z,{})})}),b(U,{open:e,onClose:i,children:[r($,{children:r(S,{direction:"row",alignItems:"center",spacing:1.5,children:r(N,{variant:"inherit",children:t("order.checkout.order-info-card.cancel-dialog.title")})})}),r(T,{}),r(J,{children:r(V,{children:t("order.checkout.order-info-card.cancel-dialog.content")})}),b(K,{children:[r(_,{onClick:i,children:t("order.checkout.order-info-card.cancel-dialog.cancel-button")}),r(_,{variant:"contained",color:"primary",onClick:l,children:t("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},be=()=>{const{t}=x(),{detail:{data:e,isLoading:i},status:c}=C(),s=u.useMemo(()=>{switch(c){case d.FINISHED:return"finished";case d.CANCELLED:return"cancelled";case d.PENDING:return"pending";case d.PAID:return"paid";default:return"cancelled"}},[c]),o=u.useMemo(()=>[{label:t("order.checkout.order-info-card.order-number"),value:e==null?void 0:e.trade_no},{label:t("order.checkout.order-info-card.order-date"),value:F.unix((e==null?void 0:e.created_at)||0).format("YYYY-MM-DD HH:mm:ss")},{label:t("order.checkout.order-info-card.order-status"),value:t("order.checkout.order-info-card.order-status-value_".concat(s))},...e!=null&&e.discount_amount?[{label:t("order.checkout.order-info-card.coupon-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.discount_amount)||0)/100).toFixed(2)})}]:[],...e!=null&&e.surplus_amount?[{label:t("order.checkout.order-info-card.subscription-deduct-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.surplus_amount)||0)/100).toFixed(2)})}]:[],{label:t("order.checkout.order-info-card.order-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.total_amount)||0)/100).toFixed(2)})}],[e,t]);return r(E,{title:t("order.checkout.order-info-card.title"),secondary:c===d.PENDING&&r(pe,{}),children:r(a,{container:!0,spacing:2,children:o.map((m,l)=>r(a,{item:!0,xs:12,children:b(a,{container:!0,spacing:2,children:[r(a,{item:!0,xs:4,children:m.label}),r(a,{item:!0,xs:8,children:r(N,{variant:"body1",noWrap:!0,children:i?r(M,{variant:"text",width:"100%"}):m.value})})]})},l))})})},fe=O()(t=>({icon:{fontSize:t.spacing(2.5)}})),ge=()=>{const{t}=x(),{paymentMethod:{isLoading:e},detail:{isLoading:i},paymentMethodIndex:c,paymentMethodState:s,setPaymentMethodState:o,isSubmitting:m}=C(),l=u.useMemo(()=>Array.from(c.values()),[c]),{classes:h}=fe(),f=u.useCallback(({icon:n})=>{switch(!0){case n.includes("alipay"):return r(Y,{type:"combined",children:r(X,{className:h.icon})});default:return r(Y,{type:"combined",color:"secondary",src:n})}},[]),v=n=>p=>{var g;p.preventDefault(),o(n.id),I.event("select",{category:"order",label:"payment_method",method:(g=c.get(n.id))==null?void 0:g.name,method_id:n.id})};return r(E,{title:t("order.checkout.payment-method-card.title"),content:!1,children:r(Z,{sx:{p:0},children:e||i?Array.from(new Array(3)).map((n,p)=>r(w,{disablePadding:!0,divider:!0,children:r(A,{disabled:!0,children:r(D,{children:r(M,{variant:"text",width:100})})})},p)):l.map(n=>r(w,{disablePadding:!0,divider:!0,children:b(A,{selected:s===n.id,disabled:m,onClick:v(n),onTouchEnd:v(n),children:[n.icon&&r(ee,{children:r(f,{icon:n.icon})}),r(D,{children:n.name})]})},n.id))})})},ke=()=>{const{t}=x(),{detail:{data:e,isLoading:i},paymentMethodState:c,paymentMethodIndex:s,setSubmitting:o,isSubmitting:m}=C(),[l]=ae(),{enqueueSnackbar:h}=L(),f=u.useMemo(()=>{var n,p,g,k;return[{label:e==null?void 0:e.plan.name,value:t("order.checkout.billing-card.price",{value:Number(((n=e==null?void 0:e.plan[e==null?void 0:e.period])!=null?n:0)/100).toFixed(2)})},...e!=null&&e.discount_amount||e!=null&&e.surplus_amount?[{label:t("order.checkout.billing-card.deduction"),value:t("order.checkout.billing-card.price",{value:((((p=e==null?void 0:e.discount_amount)!=null?p:0)+((g=e==null?void 0:e.surplus_amount)!=null?g:0))/-100).toFixed(2)})}]:[],{label:t("order.checkout.billing-card.total-price"),value:t("order.checkout.billing-card.price",{value:Number(((k=e==null?void 0:e.total_amount)!=null?k:0)/100).toFixed(2)})}]},[e,t]),v=u.useCallback(async n=>{var p,g;if(n.preventDefault(),e&&c)try{o(!0),I.event("click",{category:"order",label:"checkout",method:(p=s.get(c))==null?void 0:p.name,method_id:c}),window.location.href=await l({trade_no:e.trade_no,method:c}).unwrap()}catch(k){console.error(k),h(t("notice::checkout-failed"),{variant:"error"}),I.event("click",{category:"order",label:"checkout",method:(g=s.get(c))==null?void 0:g.name,method_id:c,success:!1,error:k})}finally{o(!1)}else h(t("notice::data-not-loaded"),{variant:"error"})},[l,e,c]);return r(E,{title:t("order.checkout.billing-card.title"),children:b(S,{spacing:2,divider:r(T,{}),children:[f.map((n,p)=>i?r(M,{variant:"text",width:"100%",height:40},p):b(S,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[r(N,{variant:"body1",children:n.label}),r(N,{variant:"body1",children:n.value})]},p)),r(_,{fullWidth:!0,variant:"contained",disabled:i||m,onClick:v,children:t("order.checkout.billing-card.button")})]})})},ve=()=>{const{status:t}=C();return b(a,{container:!0,spacing:2,children:[r(a,{item:!0,xs:!0,children:b(a,{container:!0,spacing:2,children:[t!==d.PENDING&&r(a,{item:!0,xs:12,children:r(me,{})}),r(a,{item:!0,xs:12,children:r(ue,{})}),r(a,{item:!0,xs:12,children:r(be,{})}),t===d.PENDING&&r(a,{item:!0,xs:12})]})}),t===d.PENDING&&r(a,{item:!0,xs:12,md:4,children:b(a,{container:!0,spacing:2,children:[r(a,{item:!0,xs:12,children:r(ge,{})}),r(a,{item:!0,xs:12,children:r(ke,{})})]})})]})},Se=()=>{ie("checkout");const t=re().id;return r(le,{tradeNo:t||"",children:r(ve,{})})};export{Se as default};
