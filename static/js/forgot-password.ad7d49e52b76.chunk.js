import{h as W,n as j,ba as E,aa as D,a9 as M,r as y,j as e,F as $,b0 as F,i as t,aJ as s,ah as h,bb as _,an as c,bc as S,bd as w,be as z,bf as K,bg as L,bi as G,B as V,T as v,l as H,bh as J,ao as N,m as U}from"./vendor.dee56adfed90.chunk.js";import{A as Q}from"./AuthWrapper.6496e452e81f.chunk.js";import{F as X,c as Y,a as b,b as Z}from"./formik.esm.653f75db69cb.chunk.js";import{S as ee,O as re,s as oe,a as se}from"./password-strength.32721eaa0d38.chunk.js";import{A as ae}from"./AnimateButton.3d32280d3b29.chunk.js";import{e as te,I as ie,b as ne}from"./index.23055111bb7c.js";import"./hey-listen.es.3d38fef0dd76.chunk.js";const de=()=>{const p=W(),{t:o}=j("common"),C=E(),B=D(),{enqueueSnackbar:P}=M(),[I]=te(),[m,k]=y.useState(),[g,q]=y.useState(!1),A=()=>{q(!g)},T=r=>{r.preventDefault()},x=r=>{const a=oe(r);k(se(a))};return y.useEffect(()=>{x("")},[]),e($,{children:e(X,{initialValues:{email:"",password:"",password_confirm:"",email_code:"",submit:null},validationSchema:Y().shape({email:b().email(o("forgot_password.email_invalid").toString()).max(255,o("forgot_password.email_max",{count:255}).toString()).required(o("forgot_password.email_required").toString()),password:b().max(255,o("forgot_password.password_max",{count:255}).toString()).required(o("forgot_password.password_required").toString()),password_confirm:b().oneOf([Z("password"),null],o("forgot_password.password_confirm_invalid").toString()).required(o("forgot_password.password_confirm_required").toString()),email_code:b().min(6,o("forgot_password.email_code_min",{count:6}).toString()).max(6,o("forgot_password.email_code_max",{count:6}).toString()).required(o("forgot_password.email_code_required").toString())}),onSubmit:async(r,{setErrors:a,setStatus:n,setSubmitting:f})=>{if(r.email_code.length!==6){n({success:!1}),a({email_code:o("forgot_password.email_code_invalid").toString()});return}try{await I({email:r.email,password:r.password,email_code:r.email_code}).unwrap(),C.current||(n({success:!0}),f(!1),P(o("notice::forgot_password.reset_success"),{variant:"success"}),F.event("reset_password",{category:"auth",label:"reset_password",email:r.email,success:!0}),B("/login",{replace:!0}))}catch(i){console.error("Error in reset password",i),P(i.message||o("notice::forgot_password.reset_failed"),{variant:"error"}),C.current&&(n({success:!1}),a(i.errors||{submit:i.message}),F.event("reset_password",{category:"auth",label:"reset_password",email:r.email,success:!1,error:i.message}))}finally{f(!1)}},children:({errors:r,handleBlur:a,handleChange:n,handleSubmit:f,isSubmitting:i,touched:d,values:u,setValues:O})=>e("form",{noValidate:!0,onSubmit:f,children:t(s,{container:!0,spacing:3,children:[e(s,{item:!0,xs:12,children:t(h,{spacing:1,children:[e(_,{htmlFor:"email",children:e(c,{children:"forgot_password.email"})}),e(S,{fullWidth:!0,error:!!(d.email&&r.email),id:"email",type:"email",value:u.email,name:"email",onBlur:a,onChange:n,placeholder:"user@example.com",inputProps:{},endAdornment:e(ee,{email:u.email})}),d.email&&r.email&&e(w,{error:!0,id:"helper-text-email-signup",children:r.email})]})}),e(s,{item:!0,xs:12,children:t(h,{spacing:1,children:[e(_,{htmlFor:"email-code-signup",children:e(c,{children:"forgot_password.email_code"})}),e(re,{value:u.email_code,onChange:l=>{O(R=>({...R,email_code:l}))},numInputs:6,containerStyle:{justifyContent:"space-between"},inputProps:{name:"email_code",id:"email-code-signup",onBlur:a},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:"1px solid ".concat(p.palette.mode==="dark"?p.palette.grey[200]:p.palette.grey[300]),borderRadius:4,":hover":{borderColor:p.palette.primary.main}},focusStyle:{outline:"none",boxShadow:p.customShadows.primary,border:"1px solid ".concat(p.palette.primary.main)}}),d.email_code&&r.email_code&&e(w,{error:!0,id:"helper-text-email-signup",children:r.email_code})]})}),t(s,{item:!0,xs:12,children:[t(h,{spacing:1,children:[e(_,{htmlFor:"password-signup",children:e(c,{children:"forgot_password.password"})}),e(S,{fullWidth:!0,error:!!(d.password&&r.password),id:"password-signup",type:g?"text":"password",value:u.password,name:"password",onBlur:a,onChange:l=>{n(l),x(l.target.value)},autoComplete:"new-password",endAdornment:e(z,{position:"end",children:e(ie,{"aria-label":"toggle password visibility",onClick:A,onMouseDown:T,edge:"end",color:"secondary",children:g?e(K,{}):e(L,{})})}),placeholder:"******",inputProps:{}}),d.password&&r.password&&e(w,{error:!0,id:"helper-text-password-signup",children:r.password})]}),e(G,{fullWidth:!0,sx:{mt:2},children:t(s,{container:!0,spacing:2,alignItems:"center",children:[e(s,{item:!0,children:e(V,{sx:{bgcolor:m==null?void 0:m.color,width:85,height:8,borderRadius:"7px"}})}),e(s,{item:!0,children:e(v,{variant:"subtitle1",fontSize:"0.75rem",children:o("forgot_password.password_strength",{context:H.lowerCase(m==null?void 0:m.label)}).toString()})})]})})]}),e(s,{item:!0,xs:12,children:t(h,{spacing:1,children:[e(_,{htmlFor:"password-confirm",children:e(c,{children:"forgot_password.password_confirm"})}),e(S,{fullWidth:!0,error:!!(d.password_confirm&&r.password_confirm),id:"password-confirm",type:g?"text":"password",value:u.password_confirm,name:"password_confirm",onBlur:a,onChange:l=>{n(l),x(l.target.value)},autoComplete:"new-password",placeholder:"******",inputProps:{}}),d.password_confirm&&r.password_confirm&&e(w,{error:!0,id:"helper-text-password-confirm",children:r.password_confirm})]})}),r.submit&&e(s,{item:!0,xs:12,children:e(w,{error:!0,children:r.submit})}),e(s,{item:!0,xs:12,children:e(ae,{children:e(J,{disableElevation:!0,disabled:i,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:i?e(N,{size:24}):e(c,{i18nKey:"forgot_password.submit",children:"重置密码"})})})})]})})})})},ge=()=>(ne("forgot-password"),e(Q,{children:t(s,{container:!0,spacing:3,children:[e(s,{item:!0,xs:12,children:t(h,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:{xs:-.5,sm:.5}},children:[e(v,{variant:"h3",children:e(c,{i18nKey:"forgot_password.title",children:"Forgot password"})}),e(v,{component:U,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:e(c,{i18nKey:"forgot_password.back_to_login",children:"Back to login"})})]})}),e(s,{item:!0,xs:12,children:e(de,{})})]})}));export{ge as default};
